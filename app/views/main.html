<div class="row">
    <div class="col-sm-4 col-md-3 col-lg-3" id="leftCol">
        <form name="form">
            <div>
                <input type="text" ng-model="query.text" placeholder="Suchtext" ng-change="updateMarkers()"/>
                <input type="checkbox" ng-model="query.textAppliesToAllFields" ng-change="updateMarkers()">Alle Felder durchsuchen</input>
            </div>
            <div>
                <select ng-model="query.district" ng-change="updateMarkers()">
                    <option ng-repeat="district in districts">{{district}}</option>
                </select>
                <!--input type="checkbox" ng-model="query.openNow" ng-change="updateMarkers()">Jetzt geöffnet</input-->
                <input type="checkbox" ng-model="query.completelyVegan" ng-change="updateMarkers()">100% vegan</input>
                <input type="checkbox" ng-model="query.organic" ng-change="updateMarkers()">Bio</input>
                <input type="checkbox" ng-model="query.glutenFree" ng-change="updateMarkers()">glutenfreie Speisen</input>
                <input type="checkbox" ng-model="query.handicappedAccessible" ng-change="updateMarkers()">barrierefrei</input>
                <input type="checkbox" ng-model="query.handicappedAccessibleWc" ng-change="updateMarkers()">barrierefreies WC</input>
                <input type="checkbox" ng-model="query.dog" ng-change="updateMarkers()">Hunde erlaubt</input>
                <input type="checkbox" ng-model="query.wlan" ng-change="updateMarkers()">WLAN</input>
                <input type="checkbox" ng-model="query.childChair" ng-change="updateMarkers()">Kinderstühle</input>
                <input type="checkbox" ng-model="query.catering" ng-change="updateMarkers()">Catering</input>
                <input type="checkbox" ng-model="query.delivery" ng-change="updateMarkers()">Lieferservice</input>
            </div>
            <div>
                Geöffnet:
                <select ng-model="query.openAtWeekDay" ng-change="updateMarkers()">
                    <option value="Alle Wochentage">Alle Wochentage</option>
                    <option value="1">Montag</option>
                    <option value="2">Dienstag</option>
                    <option value="3">Mittwoch</option>
                    <option value="4">Donnerstag</option>
                    <option value="5">Freitag</option>
                    <option value="6">Samstag</option>
                    <option value="0">Sonntag</option>
                </select>
                <input name="openAtTimeInput" type="time" ng-model="query.openAtTime" placeholder="hh:mm (Uhrzeit)" ng-disabled="query.openAtWeekDay === 'Alle Wochentage'" ng-change="updateMarkers()"/>
                <span class="error" ng-show="form.openAtTimeInput.$error.time">Ungültige Zeit (wird ignoriert)</span>
            </div>
            <div ng-show="geolocation.supported">
                <div>
                    <input type="checkbox" ng-model="geolocation.show" ng-change="updateGeolocationMarker()">
                        <span ng-hide="geolocation.marker.map">Standorterkennung</span>
                        <a ng-show="geolocation.marker.map" href="#" ng-click="openInfoWindow($event, geolocation.marker)">Standorterkennung</a> 
                    </input>
                </div>
                <div>
                    <span ng-bind="geolocation.info"></span>
                    <span ng-bind="geolocation.error" class="error"></span>
                </div>
                <div ng-show="geolocation.marker.map">
                    <input type="checkbox" ng-model="query.distance.enabled" ng-change="updateMarkers()">Entfernung zum Standort:</input>
                    <input type="range" min="0.1" max="10" step="0.1" ng-model="query.distance.km" ng-change="query.distance.enabled = true; updateMarkers()" />
                    <span ng-bind-template="{{query.distance.km | number : 1}} km"/>
                </div>
            </div>
            <hr/>
            <div>
                Sortierung:
                <select ng-model="orderSelection" ng-change="updateOrder()">
                    <option>Name</option>
                    <option>Veganfreundlichkeit</option>
                    <option>Bezirk</option>
                    <option ng-show="geolocation.marker.map"">Entfernung</option>
                    <option ng-hide="geolocation.marker.map" ng-disabled="true" title="Standorterkennung erforderlich">Entfernung</option>
                </select>
            </div>
        </form>
        <div id="class" ng-repeat="marker in filteredMarkers | orderBy : [order, 'location.name']">
            <hr/>
            <p>
                <a href="#" ng-click="openInfoWindow($event, marker)">{{marker.location.name}}</a>
            </p>
            <p>{{marker.location.tags.join(", ")}}</p>
            <p>{{marker.location.commentWithoutFormatting | cut:true:150:' ...'}}</p>
            <p>{{marker.location.getOpeningTimeTodayFriendly()}}</p>
            <p>{{marker.location.street}} {{marker.location.cityCode}} {{marker.location.district}}</p>
            <p ng-show="geolocation.marker.map">
                <!-- 
                    Even when not shown because geolocation.marker.map is undefined/null, the following 
                    expression gets evaluated, so we use the dummy value 0 to prevent an error when trying 
                    to get the distance when tgeolocation.marker.map is undefined/null.
                    If one could prevent AngularJS from evaluating, would be more elegant. 
                    No idea if this is possible.
                -->
                Entfernung: 
                {{ 
                    geolocation.marker.position ? marker.location.getDistanceToPositionInKm(geolocation.marker.position) : 0
                    | 
                    number : 1
                }} 
                km
            </p>
        </div>
    </div>
    <div class="col-sm-8 col-md-9 col-lg-9">
        <div id="map" style="width: auto;height: 700px;"></div>
    </div>
</div>

