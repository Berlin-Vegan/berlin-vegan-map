<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>BerlinVeganMap</title>
    <base href="/">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
    <app-root></app-root>
    <script>
        // Set globals

        var global_language;

        if (location.href.indexOf("lang=") !== -1) {
            global_language = location.href.split("lang=")[1];
        } else if (localStorage) {
            global_language = localStorage.getItem("lang") || "de";
        } else {
            var prefLang = getPreferredSupportedLanguage();
            global_language = prefLang || "de";
        }

        var global_region = (global_language === "en") ? "us" : "de";

        function getPreferredSupportedLanguage() {
            var preferredLanguages = getPreferredLanguages();
            for (var i = 0; i < preferredLanguages.length; i++) {
                var lang = preferredLanguages[i];
                if (lang === "en" || lang === "de") {
                    return lang;
                }
            }
            return null;
        }

        function getPreferredLanguages() {
            var preferredLanguages;
            if (navigator.languages !== undefined) {
                // Firefox, Chrome, Opera
                preferredLanguages = navigator.languages;
            } else if (navigator.browserLanguage !== undefined) {
                // IE11
                preferredLanguages = [navigator.browserLanguage];
            } else {
                preferredLanguages = [];
            }
            return preferredLanguages.map(
                function(it) {
                    // Remove optional region
                    return it.indexOf("-") !== -1 ? it.split("-")[0] : it;
                }
            );
        }
    </script>
    <script>
        if (window.location.hostname !== "localhost" && window.location.protocol === "http:") {
            redirectToHttps();
        } else {
            appendScript(
                "https://maps.googleapis.com/maps/api/js?language=" + global_language +"&region=" + global_region
            );
        }

        function redirectToHttps() {
            var httpsUrl = location.href.replace(/http:/, "https:");
            window.location.replace(httpsUrl);
        }

        function appendScript(url) {
            var script = document.createElement('script');
            script.src = url;
            script.async = false;
            document.head.appendChild(script);
        }

        exports = {}; // Hack to be able to use libraries from the assets folder. TODO
    </script>
    <!-- Hacky way to use index.js from https://github.com/marco-eckstein/js-common TODO -->
    <script src="assets/lib/marco-eckstein-js-common-0.5.0.js"></script>
</body>

</html>
