<form *ngIf="query" name="searchForm">
    <section class="searchTextContainer flex-container-wrap">
        <input
            type="text"
            name="text"
            [(ngModel)]="query.text"
            placeholder="{{i18n.search.text.placeholder}}"
            (keyup)="onQueryChange()"
        />
        <label>
            <input
                type="checkbox"
                name="textAppliesToNamesOnly"
                [(ngModel)]="query.textAppliesToNamesOnly"
                (change)="onQueryChange()"
            />{{i18n.search.text.namesOnly}}
        </label>
    </section>
    <section class="flex-container-wrap">
        <h1>{{i18n.category.header}}</h1>
        <div class="flex-container-wrap">
            <label *ngFor="let veganCategory of veganCategories" title="{{i18n.enums.veganCategory.verbose[veganCategory]}}">
                <input
                    type="checkbox"
                    name="veganCategory"
                    [(ngModel)]="query.veganCategories[veganCategory]"
                    (change)="onQueryChange()"
                /><span
                    [style.border-bottom]="'3px dotted ' + configurationService.getColor(veganCategory)"
                >{{i18n.enums.veganCategory.concise[veganCategory]}}
                </span>
            </label>
        </div>
    </section>
    <section class="flex-container-wrap">
        <h1>{{i18n.tag.header}}</h1>
        <div *ngIf="isGastro" class="flex-container-wrap">
            <label *ngFor="let tag of tags">
                <input
                    type="checkbox"
                    name="tags"
                    [(ngModel)]="query.tags[tag]"
                    (change)="onQueryChange()"
                />{{i18n.enums.gastroTag[tag]}}
            </label>
        </div>
        <div *ngIf="!isGastro" class="flex-container-wrap">
            <label *ngFor="let tag of tags">
                <input
                    type="checkbox"
                    name="tags"
                    [(ngModel)]="query.tags[tag]"
                    (change)="onQueryChange()"
                />{{i18n.enums.shoppingTag[tag]}}
            </label>
        </div>
    </section>
    <section *ngIf="isGastro" class="flex-container-wrap">
        <div class="feature-col">
            <label *ngFor="let feature of ['organic', 'breakfast', 'dog', 'handicappedAccessible', 'delivery', 'wlan']">
                <input
                    type="checkbox"
                    name="{{feature}}"
                    [(ngModel)]="query[feature]"
                    (change)="onQueryChange()"
                />{{i18n.features[feature]}}
            </label>
        </div>
        <div class="feature-col">
            <label *ngFor="let feature of ['glutenFree', 'brunch', 'childChair', 'handicappedAccessibleWc', 'catering', 'review']">
                <input
                    type="checkbox"
                    name="{{feature}}"
                    [(ngModel)]="query[feature]"
                    (change)="onQueryChange()"
                />{{i18n.features[feature]}}
            </label>
        </div>
    </section>
    <section class="flex-container-wrap">
        <h1>{{i18n.openingTimes.header}}</h1>
        <div>
            <span [hidden]="query.openNow">
                <select name="openAtWeekDay" [(ngModel)]="query.openAtWeekDay" (change)="onQueryChange()">
                    <option value="all">{{i18n.enums.weekday.all}}</option>
                    <option *ngFor="let i of [1, 2, 3, 4, 5, 6, 0]" value="{{i}}">{{i18n.enums.weekday[i + ""]}}</option>
                </select>
                <input
                    name="openAtTime"
                    type="time"
                    [(ngModel)]="query.openAtTime"
                    placeholder="{{i18n.openingTimes.timePlaceholder.notOpenNow}}"
                    [disabled]="query.openAtWeekDay === 'all'"
                    (keyup)="onQueryChange()"
                    (change)="onQueryChange()"
                    size="15"
                    minlength="5"
                    maxlength="5"
                />
            </span>
            <span [hidden]="!query.openNow">
                <select [disabled]="true">
                    <option>-{{i18n.enums.weekday.today}}-</option>
                    <option>{{i18n.enums.weekday.all}}</option><!-- So this select element gets the same size as the "real" select element.-->
                </select>
                <input type="time" placeholder="{{i18n.openingTimes.timePlaceholder.openNow}}" [disabled]="true" size="15"/>
            </span>
            <label>
                <input
                    type="checkbox"
                    name="openNow"
                    [(ngModel)]="query.openNow"
                    (change)="onQueryChange()"
                />{{i18n.openingTimes.nowCheckbox}}
            </label>
            <span class="error" [hidden]="!query.openAtTime || query.openAtTimeAsDate()">{{i18n.openingTimes.invalidTime}}</span>
        </div>
    </section>
    <section>
        <app-geolocation
            (positionChange)="onGeopositionChange($event)"
            (highlightRequest)="geopositionHighlightRequest.emit()"
        ></app-geolocation>
        <div class="distanceContainer flex-container-wrap" *ngIf="query.distance.position">
            <label>
                <input
                    type="checkbox"
                    name="distance.enabled"
                    [(ngModel)]="query.distance.enabled"
                    (change)="onQueryChange()"
                />{{i18n.geolocation.distance}}:
            </label>
            <input
                type="range"
                name="distance.km"
                min="0.1"
                max="10"
                step="0.1"
                [(ngModel)]="query.distance.km"
                (input)="query.distance.enabled = true; onQueryChange()"
                (change)="query.distance.enabled = true; onQueryChange()"
            /><span>{{query.distance.km | kilometer }}</span>
        </div>
    </section>
</form>
